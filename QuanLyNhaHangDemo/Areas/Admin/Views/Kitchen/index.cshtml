@model IEnumerable<OrderDetails>

@{
    ViewData["Title"] = ViewBag.ScreenTitle ?? "Bếp";
}

<h2 class="mb-3">@ViewBag.ScreenTitle</h2>

<!-- Thanh chuyển khu bếp -->
<nav class="mb-3">
    <a asp-area="Admin" asp-controller="Kitchen" asp-action="KhaiVi"
       class="btn btn-outline-primary btn-sm me-1">
        Khu bếp khai vị
    </a>
    <a asp-area="Admin" asp-controller="Kitchen" asp-action="MonChinh"
       class="btn btn-outline-primary btn-sm me-1">
        Khu bếp món chính
    </a>
    <a asp-area="Admin" asp-controller="Kitchen" asp-action="DoUong"
       class="btn btn-outline-primary btn-sm">
        Khu đồ uống
    </a>
</nav>

<table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
        <tr>
            <th>Tên món</th>
            <th>Số lượng</th>
            <th>Loại món</th>
            <th>Trạng thái hiện tại</th>
            <th>Cập nhật trạng thái</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Product.Name</td>
                <td>@item.Quantity</td>
                <td>@item.Product.Category.Name</td>
                <td>
                    @{
                        var statusText = item.Status switch
                        {
                            0 => "Đang Chuẩn Bị Nguyên Liệu",
                            1 => "Đang làm",
                            2 => "Hoàn thành",
                            3 => "Đã hủy",
                            _ => "Không xác định"
                        };
                    }
                    @statusText
                </td>
                <td>
                    <form asp-area="Admin"
                          asp-controller="Kitchen"
                          asp-action="UpdateStatus"
                          method="post" class="form-inline">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="orderDetailId" value="@item.Id" />

                        @* Giữ lại action hiện tại để redirect đúng khu *@
                        <input type="hidden" name="returnAction"
                               value="@ViewContext.RouteData.Values["action"]" />

                        <select name="status" class="form-select form-select-sm">
                            <option value="0" selected="@(item.Status == 0)">
                                Đang Chuẩn Bị Nguyên Liệu
                            </option>
                            <option value="1" selected="@(item.Status == 1)">
                                Đang làm
                            </option>
                            <option value="2" selected="@(item.Status == 2)">
                                Hoàn thành
                            </option>

                        </select>

                        <button type="submit" class="btn btn-sm btn-primary mt-1">
                            Lưu
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
